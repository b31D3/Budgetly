<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Setup Admin - One Time Use Only</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #EF3D38;
    }
    .warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #EF3D38;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
    }
    button:hover {
      background: #d63530;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .success {
      background: #d4edda;
      border: 2px solid #28a745;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      display: none;
    }
    .error {
      background: #f8d7da;
      border: 2px solid #dc3545;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      display: none;
    }
    .instructions {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin: 20px 0;
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Budgetly Admin Setup</h1>

    <div class="warning">
      <strong>‚ö†Ô∏è SECURITY WARNING</strong><br>
      This page should be <strong>deleted</strong> after use!<br>
      Never deploy this to production.
    </div>

    <div class="instructions">
      <h3>Prerequisites:</h3>
      <ol>
        <li>Deploy Cloud Functions with <code>setAdminByEmail</code> function</li>
        <li>Set environment variable <code>ADMIN_SECRET</code> in Firebase</li>
        <li>Only run this once to set admin privileges</li>
      </ol>
    </div>

    <form id="setupForm">
      <label>
        <strong>Admin Email:</strong>
        <input type="email" id="email" placeholder="beidemariamshumet@gmail.com" required>
      </label>

      <label>
        <strong>Secret Key:</strong>
        <input type="password" id="secret" placeholder="Your secret key from Cloud Function" required>
      </label>

      <button type="submit" id="submitBtn">Set Admin Privileges</button>
    </form>

    <div class="success" id="successMsg">
      <strong>‚úÖ Success!</strong><br>
      <p id="successText"></p>
      <p><strong>Next steps:</strong></p>
      <ol>
        <li>Sign out and sign back in</li>
        <li><strong>DELETE THIS FILE (setup-admin.html)</strong></li>
        <li>Disable or delete the Cloud Function</li>
      </ol>
    </div>

    <div class="error" id="errorMsg">
      <strong>‚ùå Error!</strong><br>
      <p id="errorText"></p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js';

    // Initialize Firebase with your config
    // REPLACE THESE WITH YOUR ACTUAL FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const functions = getFunctions(app);

    const form = document.getElementById('setupForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMsg = document.getElementById('successMsg');
    const errorMsg = document.getElementById('errorMsg');
    const successText = document.getElementById('successText');
    const errorText = document.getElementById('errorText');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const secret = document.getElementById('secret').value;

      // Hide previous messages
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';

      // Disable button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Setting admin privileges...';

      try {
        // Call the Cloud Function
        const setAdminByEmail = httpsCallable(functions, 'setAdminByEmail');
        const result = await setAdminByEmail({ email, secret });

        // Show success message
        successText.textContent = result.data.message + ` (UID: ${result.data.uid})`;
        successMsg.style.display = 'block';

        // Clear form
        form.reset();
      } catch (error) {
        // Show error message
        errorText.textContent = error.message || 'Failed to set admin privileges. Check console for details.';
        errorMsg.style.display = 'block';
        console.error('Error:', error);
      } finally {
        // Re-enable button
        submitBtn.disabled = false;
        submitBtn.textContent = 'Set Admin Privileges';
      }
    });
  </script>
</body>
</html>
